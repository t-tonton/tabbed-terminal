name: Release Label Check

on:
  pull_request:
    types: [opened, reopened, synchronize, labeled, unlabeled, ready_for_review]

jobs:
  require-release-label:
    name: Require release:* label
    runs-on: ubuntu-latest
    steps:
      - name: Validate release label
        uses: actions/github-script@v7
        with:
          script: |
            const required = ['release:major', 'release:minor', 'release:patch'];
            const labels = context.payload.pull_request.labels.map((l) => l.name);
            const matched = required.filter((name) => labels.includes(name));

            if (matched.length !== 1) {
              core.setFailed(
                `Exactly one release label is required: ${required.join(', ')}. ` +
                `Current labels: ${labels.join(', ') || '(none)'}`
              );
            } else {
              core.info(`Release label check passed: ${matched[0]}`);
            }
